"use strict";(self.webpackChunkdocs_hackuarium_org=self.webpackChunkdocs_hackuarium_org||[]).push([[1574],{15929:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var t=r(11527),n=r(11683);const i={},o="Set environment",a={id:"programming/esp32/README",title:"Set environment",description:"Install platform IO cli",source:"@site/docs/06-programming/02-esp32/01-README.md",sourceDirName:"06-programming/02-esp32",slug:"/programming/esp32/README",permalink:"/docs/programming/esp32/README",draft:!1,unlisted:!1,editUrl:"https://github.com/hackuarium/docs.hackuarium.org/edit/main/docs/06-programming/02-esp32/01-README.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ESP32",permalink:"/docs/category/esp32"},next:{title:"Led pins",permalink:"/docs/programming/esp32/blink"}},l={},c=[{value:"Install platform IO cli",id:"install-platform-io-cli",level:2},{value:"Mac OS - OsX",id:"mac-os---osx",level:2},{value:"FS",id:"fs",level:2},{value:"Alternative web server",id:"alternative-web-server",level:2},{value:"Searching libraries",id:"searching-libraries",level:2},{value:"OTA",id:"ota",level:2}];function p(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"set-environment",children:"Set environment"}),"\n",(0,t.jsx)(s.h2,{id:"install-platform-io-cli",children:"Install platform IO cli"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"export PATH=$PATH:~/.platformio/penv/bin"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-cpp",children:'printf("Restarting now.\\n");\nfflush(stdout);\nesp_restart();\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"IDF_PATH=~/.platformio/packages/framework-espidf/"})}),"\n",(0,t.jsxs)(s.p,{children:["You may have to add pyserial:\n",(0,t.jsx)(s.code,{children:"sudo pip3 install pyserial"})]}),"\n",(0,t.jsxs)(s.p,{children:["Read device info:\n",(0,t.jsx)(s.code,{children:"python3 $IDF_PATH/components/esptool_py/esptool/esptool.py --port /dev/cu.usbserial-A5XK3RJT flash_id"})]}),"\n",(0,t.jsx)(s.p,{children:"Read partition table"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"python3 $IDF_PATH/components/esptool_py/esptool/esptool.py --port /dev/cu.usbserial-A5XK3RJT read_flash 0x8000 0xc00 ptable.img"})}),"\n",(0,t.jsxs)(s.p,{children:["We can now check the content of the ",(0,t.jsx)(s.code,{children:"ptable.img"})," file\n",(0,t.jsx)(s.code,{children:"python3 $IDF_PATH/components/partition_table/gen_esp32part.py ptable.img"})]}),"\n",(0,t.jsx)(s.p,{children:"Here is an example of the result:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Espressif ESP32 Partition Table\n# Name, Type, SubType, Offset, Size, Flags\nnvs,data,nvs,0x9000,20K,\notadata,data,ota,0xe000,8K,\napp0,app,ota_0,0x10000,1280K,\napp1,app,ota_1,0x150000,1280K,\nspiffs,data,spiffs,0x290000,1472K,\n"})}),"\n",(0,t.jsx)(s.h2,{id:"mac-os---osx",children:"Mac OS - OsX"}),"\n",(0,t.jsx)(s.p,{children:"You may encounter a problem uploading the file to ESP32 that uses the new chip USB/UART CH9102x."}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"A fatal error occurred: Failed to write to target RAM (result was 01070000)"})}),"\n",(0,t.jsx)(s.p,{children:"You may find more information about solving this problem at:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://blog.squix.org/2021/08/ch9102-driver-issues-failed-to-write-to-target-ram.html",children:"https://blog.squix.org/2021/08/ch9102-driver-issues-failed-to-write-to-target-ram.html"})}),"\n",(0,t.jsx)(s.p,{children:"It is related to those issues:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/espressif/esptool/issues/280",children:"https://github.com/espressif/esptool/issues/280"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/Xinyuan-LilyGO/LilyGo-T-Call-SIM800/issues/139",children:"https://github.com/Xinyuan-LilyGO/LilyGo-T-Call-SIM800/issues/139"})}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["This driver may help on Big Sur b tu fails for the last Monterey version ",(0,t.jsx)(s.a,{target:"_blank",href:r(52941).Z+"",children:"CH9102_Mac_Driver.zip"})]}),"\n",(0,t.jsxs)(s.p,{children:["Code: ",(0,t.jsx)(s.a,{href:"https://github.com/WCHSoftGroup/ch34xser_macos",children:"https://github.com/WCHSoftGroup/ch34xser_macos"})]}),"\n",(0,t.jsxs)(s.p,{children:["On M1 we may have to explicitely accept kext (kernel extensions): ",(0,t.jsx)(s.a,{href:"https://support.apple.com/guide/security/kernel-extensions-sec8e454101b/1/web/1#sec8697bc589",children:"https://support.apple.com/guide/security/kernel-extensions-sec8e454101b/1/web/1#sec8697bc589"})]}),"\n",(0,t.jsx)(s.h2,{id:"fs",children:"FS"}),"\n",(0,t.jsxs)(s.p,{children:["Create a folder at the first level called ",(0,t.jsx)(s.code,{children:"data"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"To upload the data"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.code,{children:"pio run --target uploadfs"})}),"\n",(0,t.jsx)(s.h2,{id:"alternative-web-server",children:"Alternative web server"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://github.com/me-no-dev/ESPAsyncWebServer#using-platformio",children:"https://github.com/me-no-dev/ESPAsyncWebServer#using-platformio"})}),"\n",(0,t.jsx)(s.h2,{id:"searching-libraries",children:"Searching libraries"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.a,{href:"https://platformio.org/lib/search?query=si7021",children:"https://platformio.org/lib/search?query=si7021"})}),"\n",(0,t.jsx)(s.h2,{id:"ota",children:"OTA"}),"\n",(0,t.jsx)(s.p,{children:"pio run -t upload --upload-port square.local\npio run -t uploadfs --upload-port square.local"})]})}function d(e={}){const{wrapper:s}={...(0,n.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},52941:(e,s,r)=>{r.d(s,{Z:()=>t});const t=r.p+"assets/files/CH9102_Mac_Driver-70221bdd0d0e25a4925b9de133d36a1d.zip"},11683:(e,s,r)=>{r.d(s,{Z:()=>a,a:()=>o});var t=r(50959);const n={},i=t.createContext(n);function o(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);